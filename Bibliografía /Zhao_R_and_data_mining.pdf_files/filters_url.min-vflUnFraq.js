define(["require","exports","tslib","modules/clean/datetime","modules/clean/rondo/router/location_utils","modules/clean/teams/admin/pages/activity/filters/initial_values","modules/clean/rondo/components/members_picker/contacts_picker_behavior","modules/clean/teams/admin/pages/activity/activity_api","modules/clean/rondo/forms/fields/datepicker_range","modules/clean/rondo/components/team_picker/team_picker_behavior","modules/clean/teams/admin/pages/activity/filters/types"],(function(e,t,n,a,i,r,s,o,m,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),l=n.__importStar(l),t.filtersToURLSearch=function(e){var t,n={from:a.format_date(new Date(e.date.from),"y-MM-dd"),to:a.format_date(new Date(e.date.to),"y-MM-dd")};e.members&&e.members.length>0&&((t=e.members.filter((function(e){return!e.content.invalid&&!e.content.pending})).map((function(e){return e.key}))).length>0&&(n.member=t.join(",")));e.teams&&e.teams.length>0&&((t=e.teams.map((function(e){return e.content.dbtid}))).length>0&&(n.team_ids=t.join(",")));return e.file&&(n.asset_prefix=e.file),e.activity&&e.activity.length&&(n.event_types=e.activity.map((function(e){return e.event_type[".tag"]})).join(",")),void 0!==e.participants&&e.participants!==c.InvolveNoneTeamMembers.DEFAULT&&(n.include_only_non_team_member_events=e.participants===c.InvolveNoneTeamMembers.YES),n},t.selectedActivities=function(e,t){for(var n=[],a=0,i=t;a<i.length;a++)for(var r=0,s=i[a].activities;r<s.length;r++){var o=s[r];e.indexOf(o.id)>=0&&n.push(o)}return n},t.urlSearchToFilters=function(e,a){return n.__awaiter(void 0,void 0,void 0,(function(){var u,d,p,_,v,f,b,y,h,g;return n.__generator(this,(function(n){switch(n.label){case 0:return u=i.searchToParams(e),d={},u.event_types?(p=u.event_types.split(","),d.activity=t.selectedActivities(p,a)):d.activity=r.emptyListFilterValueClear(),_=r.dateFilterValueClear(),u.from&&3===(v=u.from.split("-").map((function(e){return Number(e)}))).length&&(_.from=m.dayOnlyTime(new Date(v[0],v[1]-1,v[2]))),u.to&&3===(f=u.to.split("-").map((function(e){return Number(e)}))).length&&(_.to=m.dayOnlyTime(new Date(f[0],f[1]-1,f[2]))),d.date=_,d.file=u.asset_prefix||r.fileFilterValueClear(),u.member?[4,o.partakers({accounts_ids:u.member.split(",")})[0]]:[3,2];case 1:return b=n.sent(),d.members=b.results.map((function(e){return s.parseTokenObject(e)})),[3,3];case 2:d.members=r.emptyListFilterValueClear(),n.label=3;case 3:return u.team_ids?[4,l.fetchTeamData(!0)]:[3,5];case 4:y=n.sent(),h=u.team_ids.split(","),g=y.filter((function(e){return h.includes(e.dbtid)})),d.teams=g.map((function(e){return l.parseTeamSingleTokenObject(e)})),n.label=5;case 5:return d.participants=void 0===u.include_only_non_team_member_events?r.emptyEnumValueClear():u.include_only_non_team_member_events?c.InvolveNoneTeamMembers.YES:c.InvolveNoneTeamMembers.NO,[2,d]}}))}))}}));
//# sourceMappingURL=filters_url.min.js-vflsZm2i5.map